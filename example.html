<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twibbon PFP</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f0f0f0;
    margin: 0;
    padding: 20px;
  }
  #drop-area {
    border: 2px dashed #ccc;
    border-radius: 10px;
    width: 100%;
    max-width: 350px;
    height: 350px;
    margin: auto;
    background: white;
    position: relative;
    overflow: hidden;
  }
  #drop-area.hover { border-color: #333; }
  #hint {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #888;
  }
  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  .controls {
    margin-top: 15px;
  }
  button {
    padding: 10px;
    font-size: 16px;
    margin: 5px 0;
  }
  .btn-row {
    display: flex;
    gap: 5px;
    justify-content: center;
  }
  .btn-row button {
    flex: 1;
  }
</style>
</head>
<body>

<h2>Twibbon PFP</h2>
<div id="drop-area">
  <div id="hint">Tarik & Lepas gambar atau ketuk untuk pilih</div>
  <canvas id="canvas"></canvas>
</div>

<div class="controls">
  <input type="file" id="fileElem" accept="image/*" style="display:none">
  <button id="downloadBtn" disabled style="width:100%">Unduh</button>
  <div id="shareReset" class="btn-row" style="display:none">
    <button id="shareBtn">Bagikan</button>
    <button id="resetBtn">Reset</button>
  </div>
</div>

<script>
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('fileElem');
const hint = document.getElementById('hint');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const btnDownload = document.getElementById('downloadBtn');
const btnShare = document.getElementById('shareBtn');
const btnReset = document.getElementById('resetBtn');
const shareReset = document.getElementById('shareReset');

let img = new Image();
let twibbon = new Image();
let imgX = 0, imgY = 0, scale = 1, startX = 0, startY = 0;
let isDragging = false, lastDist = 0;
let twibbonAlpha = 1;

canvas.width = 1000;
canvas.height = 1000;

twibbon.src = 'twibbon.png'; // path twibbon
twibbon.onload = drawPlaceholder;

function drawPlaceholder() {
  ctx.fillStyle = "#ddd";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

dropArea.addEventListener('click', () => {
  if (!fileInput.disabled) fileInput.click();
});
fileInput.addEventListener('change', e => handleFile(e.target.files[0]));

['dragenter','dragover'].forEach(ev => {
  dropArea.addEventListener(ev, e => {
    e.preventDefault();
    dropArea.classList.add('hover');
  });
});
['dragleave','drop'].forEach(ev => {
  dropArea.addEventListener(ev, e => {
    e.preventDefault();
    dropArea.classList.remove('hover');
  });
});
dropArea.addEventListener('drop', e => {
  handleFile(e.dataTransfer.files[0]);
});

function handleFile(file) {
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    img = new Image();
    img.onload = () => {
      imgX = canvas.width/2 - img.width/2;
      imgY = canvas.height/2 - img.height/2;
      scale = 1;
      fileInput.disabled = true;
      btnDownload.disabled = false;
      hint.style.display = 'none'; // ⬅ sembunyikan placeholder text
      draw();
    }
    img.src = e.target.result;
  }
  reader.readAsDataURL(file);
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "#ddd";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if (img.src) {
    ctx.drawImage(img, imgX, imgY, img.width*scale, img.height*scale);
    ctx.globalAlpha = twibbonAlpha;
    ctx.drawImage(twibbon, 0, 0, canvas.width, canvas.height);
    ctx.globalAlpha = 1;
  }
}

canvas.addEventListener('touchstart', e => {
  if (e.touches.length === 1) {
    isDragging = true;
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
    twibbonAlpha = 0.5;
  } else if (e.touches.length === 2) {
    lastDist = getDistance(e.touches);
    twibbonAlpha = 0.5;
  }
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  if (e.touches.length === 1 && isDragging) {
    let dx = e.touches[0].clientX - startX;
    let dy = e.touches[0].clientY - startY;
    imgX += dx;
    imgY += dy;
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
    draw();
  } else if (e.touches.length === 2) {
    let dist = getDistance(e.touches);
    if (lastDist) {
      let delta = dist - lastDist;
      scale += delta/200;
      scale = Math.max(scale, 0.1);
    }
    lastDist = dist;
    draw();
  }
});
canvas.addEventListener('touchend', () => {
  isDragging = false;
  lastDist = 0;
  twibbonAlpha = 1;
  draw();
});

function getDistance(touches) {
  let dx = touches[0].clientX - touches[1].clientX;
  let dy = touches[0].clientY - touches[1].clientY;
  return Math.sqrt(dx*dx + dy*dy);
}

btnDownload.addEventListener('click', () => {
  const link = document.createElement('a');
  link.download = 'twibbon.png';
  link.href = canvas.toDataURL('image/png', 1.0);
  link.click();
  btnDownload.style.display = 'none';
  shareReset.style.display = 'flex';
});

btnShare.addEventListener('click', async () => {
  const blob = await (await fetch(canvas.toDataURL('image/png', 1.0))).blob();
  navigator.share?.({ files: [new File([blob], 'twibbon.png', {type:'image/png'})] });
});

btnReset.addEventListener('click', () => {
  img = new Image();
  fileInput.value = '';
  fileInput.disabled = false;
  btnDownload.disabled = true;
  btnDownload.style.display = 'block';
  shareReset.style.display = 'none';
  hint.style.display = 'block'; // ⬅ tampilkan lagi placeholder text
  drawPlaceholder();
});
</script>
</body>
</html>
