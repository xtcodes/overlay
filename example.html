<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Twibbon PFP HD</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0; padding: 0;
        display: flex; flex-direction: column; align-items: center;
        background: #f5f5f5;
    }
    .drop-area {
        position: relative;
        width: 100%;
        max-width: 400px;
        aspect-ratio: 1/1;
        border: 2px dashed #ccc;
        display: flex; align-items: center; justify-content: center;
        background: white;
        overflow: hidden;
        touch-action: none;
    }
    canvas {
        width: 100%;
        height: 100%;
        display: block;
        background: white;
    }
    .placeholder {
        position: absolute;
        text-align: center;
        color: #aaa;
        font-size: 16px;
        pointer-events: none;
    }
    .controls {
        margin-top: 10px;
        display: flex; gap: 10px;
        flex-wrap: wrap;
        width: 100%;
        max-width: 400px;
    }
    button {
        flex: 1;
        padding: 10px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
        background: #007bff;
        color: white;
    }
    button:disabled {
        background: rgba(0, 123, 255, 0.5);
        cursor: not-allowed;
    }
    .hidden { display: none; }
</style>
</head>
<body>

<h2>Twibbon PFP HD</h2>

<div class="drop-area" id="dropArea">
    <canvas id="canvas"></canvas>
    <div class="placeholder" id="placeholder">Tarik & Letakkan Gambar<br>atau Klik untuk Unggah</div>
</div>

<div class="controls">
    <button id="downloadBtn" disabled>Unduh</button>
    <button id="shareBtn" class="hidden">Bagikan</button>
    <button id="resetBtn" class="hidden">Reset</button>
</div>

<input type="file" id="fileInput" accept="image/*" class="hidden">

<script>
const dropArea = document.getElementById('dropArea');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const placeholder = document.getElementById('placeholder');
const fileInput = document.getElementById('fileInput');
const downloadBtn = document.getElementById('downloadBtn');
const shareBtn = document.getElementById('shareBtn');
const resetBtn = document.getElementById('resetBtn');

let imgUser = null, imgTwibbon = new Image(), scale = 1, posX = 0, posY = 0;
let dragging = false, lastX, lastY, lastDist;

canvas.width = canvas.height = 400;
imgTwibbon.src = "twibbon.png"; // ganti dengan twibbon asli 1024x1024

function drawCanvas(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(imgUser){
        let iw = imgUser.width * scale;
        let ih = imgUser.height * scale;
        ctx.drawImage(imgUser, posX, posY, iw, ih);
    }
    if(imgTwibbon.complete){
        ctx.globalAlpha = dragging ? 0.5 : 1;
        ctx.drawImage(imgTwibbon, 0, 0, canvas.width, canvas.height);
        ctx.globalAlpha = 1;
    }
}

dropArea.addEventListener('click', ()=> fileInput.click());

fileInput.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = ev=>{
            imgUser = new Image();
            imgUser.onload = ()=>{
                placeholder.classList.add('hidden');
                scale = Math.min(canvas.width/imgUser.width, canvas.height/imgUser.height);
                posX = (canvas.width - imgUser.width*scale)/2;
                posY = (canvas.height - imgUser.height*scale)/2;
                drawCanvas();
                downloadBtn.disabled = false;
            };
            imgUser.src = ev.target.result;
        };
        reader.readAsDataURL(file);
    }
});

// Geser & Zoom
dropArea.addEventListener('touchstart', e=>{
    e.preventDefault();
    if(e.touches.length === 1){
        dragging = true;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
    } else if(e.touches.length === 2){
        lastDist = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
        );
    }
});

dropArea.addEventListener('touchmove', e=>{
    e.preventDefault();
    if(e.touches.length === 1 && dragging){
        let dx = e.touches[0].clientX - lastX;
        let dy = e.touches[0].clientY - lastY;
        posX += dx; posY += dy;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
    } else if(e.touches.length === 2){
        let dist = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
        );
        let delta = dist - lastDist;
        scale *= 1 + delta/200;
        lastDist = dist;
    }
    drawCanvas();
});

dropArea.addEventListener('touchend', e=>{
    dragging = false;
    drawCanvas();
});

// Unduh
downloadBtn.addEventListener('click', ()=>{
    if(!imgUser) return;
    downloadBtn.disabled = true;
    // Canvas HD export
    let exportCanvas = document.createElement('canvas');
    exportCanvas.width = exportCanvas.height = 3000;
    let ex = exportCanvas.getContext('2d');

    let scaleFactor = exportCanvas.width / canvas.width;
    ex.drawImage(imgUser, posX*scaleFactor, posY*scaleFactor, imgUser.width*scale*scaleFactor, imgUser.height*scale*scaleFactor);
    ex.drawImage(imgTwibbon, 0, 0, exportCanvas.width, exportCanvas.height);

    let link = document.createElement('a');
    link.download = "twibbon.png";
    link.href = exportCanvas.toDataURL("image/png", 1.0);
    link.click();

    shareBtn.classList.remove('hidden');
    resetBtn.classList.remove('hidden');
    downloadBtn.classList.add('hidden');
});

// Reset
resetBtn.addEventListener('click', ()=>{
    imgUser = null;
    placeholder.classList.remove('hidden');
    downloadBtn.disabled = true;
    downloadBtn.classList.remove('hidden');
    shareBtn.classList.add('hidden');
    resetBtn.classList.add('hidden');
    ctx.clearRect(0,0,canvas.width,canvas.height);
});
</script>

</body>
</html>
