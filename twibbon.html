<!DOCTYPE html>
<html lang="id">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Twibbon Generator</title>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: sans-serif;
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 20px;
Â  Â  }

Â  Â  canvas {
Â  Â  Â  max-width: 100%;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  touch-action: none;
Â  Â  Â  position: relative;
Â  Â  Â  transition: filter 0.3s ease;
Â  Â  }

Â  Â  .btn {
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  margin: 10px 5px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  #unduhBtn, #bagikanBtn {
Â  Â  Â  display: none;
Â  Â  }

Â  Â  input[type="file"] {
Â  Â  Â  display: none;
Â  Â  }

Â  Â  #canvasWrapper {
Â  Â  Â  position: relative;
Â  Â  Â  display: inline-block;
      max-width: 100%;
Â  Â  }

Â  Â  #uploadTwibbonBtn {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 10px;
Â  Â  Â  left: 10px;
Â  Â  Â  background: rgba(0, 0, 0, 0.6);
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  font-size: 12px;
Â  Â  Â  padding: 5px 10px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  z-index: 10;
Â  Â  Â  display: none;
Â  Â  }

Â  Â  /* ðŸ”§ Spinner dan teks proses */
Â  Â  #processingOverlay {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 50%;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  display: none;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  background: rgba(0,0,0,0.5);
Â  Â  Â  color: white;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  z-index: 20;
Â  Â  }

Â  Â  #processingOverlay .spinner {
Â  Â  Â  border: 4px solid rgba(255, 255, 255, 0.3);
Â  Â  Â  border-top: 4px solid white;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 20px;
Â  Â  Â  height: 20px;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  Â  margin-right: 10px;
Â  Â  }

    /* Spinner kecil */
.spinner {
Â  width: 16px;
Â  height: 16px;
Â  border: 3px solid rgba(255,255,255,0.3);
Â  border-top: 3px solid white;
Â  border-radius: 50%;
Â  margin-right: 10px;
Â  animation: spin 1s linear infinite;
      }
    
Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }

Â  Â  /* ðŸ”§ Link alternatif */
Â  Â  #downloadAlt {
Â  Â  Â  margin-top: 15px;
Â  Â  Â  display: none;
Â  Â  Â  color: #0066cc;
Â  Â  Â  text-decoration: underline;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  </style>
</head>
<body>
Â  <h2>Twibbon Generator</h2>

Â  <button id="uploadBtn" class="btn">Unggah Gambar</button>
Â  <input type="file" id="uploadInput" accept="image/*" />

Â  <div id="canvasWrapper">
Â  Â  <canvas id="canvas" width="800" height="800"></canvas>
Â  Â  <div id="processingOverlay"> <!-- ðŸ”§ Spinner + teks -->
Â  Â  Â  <div class="spinner"></div>
Â  Â  Â  <span>Sedang proses...</span>
Â  Â  </div>
Â  Â  <button id="uploadTwibbonBtn">Ubah Twibbon</button>
Â  Â  <input type="file" id="twibbonInput" accept="image/png" />
Â  </div>

Â  <button id="unduhBtn" class="btn">Unduh Hasil Twibbon</button>
Â  <button id="bagikanBtn" class="btn">Bagikan</button>

Â  <div id="downloadAlt">Klik di sini jika unduhan tidak dimulai otomatis</div> <!-- ðŸ”§ -->

Â  <script>
Â  Â  const canvas = document.getElementById("canvas");
Â  Â  const ctx = canvas.getContext("2d");

Â  Â  const uploadInput = document.getElementById("uploadInput");
Â  Â  const uploadBtn = document.getElementById("uploadBtn");
Â  Â  const unduhBtn = document.getElementById("unduhBtn");
Â  Â  const bagikanBtn = document.getElementById("bagikanBtn");
Â  Â  const twibbonInput = document.getElementById("twibbonInput");
Â  Â  const uploadTwibbonBtn = document.getElementById("uploadTwibbonBtn");
Â  Â  const processingOverlay = document.getElementById("processingOverlay"); // ðŸ”§
Â  Â  const downloadAlt = document.getElementById("downloadAlt"); // ðŸ”§

Â  Â  const placeholder = new Image();
Â  Â  placeholder.src = "placeholder.png"; // Ganti sesuai file kamu

Â  Â  let userImage = null;
Â  Â  let twibbonImage = new Image();
Â  Â  twibbonImage.src = "twibbon.png";

Â  Â  let scale = 1, lastScale = 1;
Â  Â  let posX = 0, posY = 0;
Â  Â  let lastPosX = 0, lastPosY = 0;
Â  Â  let isDragging = false;
Â  Â  let isTouching = false;
Â  Â  let lastTouches = [];

Â  Â  function drawCanvas() {
Â  Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);

Â  Â  Â  if (userImage) {
Â  Â  Â  Â  ctx.save();
Â  Â  Â  Â  ctx.translate(posX, posY);
Â  Â  Â  Â  ctx.scale(scale, scale);

Â  Â  Â  Â  const ratio = Math.min(
Â  Â  Â  Â  Â  canvas.width / userImage.width,
Â  Â  Â  Â  Â  canvas.height / userImage.height
Â  Â  Â  Â  );
Â  Â  Â  Â  const imgWidth = userImage.width * ratio;
Â  Â  Â  Â  const imgHeight = userImage.height * ratio;
Â  Â  Â  Â  ctx.drawImage(userImage, 0, 0, imgWidth, imgHeight);
Â  Â  Â  Â  ctx.restore();

Â  Â  Â  Â  if (twibbonImage.complete) {
Â  Â  Â  Â  Â  ctx.globalAlpha = isTouching ? 0.5 : 1;
Â  Â  Â  Â  Â  ctx.drawImage(twibbonImage, 0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  Â  ctx.globalAlpha = 1;
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  ctx.drawImage(placeholder, 0, 0, canvas.width, canvas.height);
Â  Â  Â  }
Â  Â  }

Â  Â  placeholder.onload = drawCanvas;
Â  Â  twibbonImage.onload = drawCanvas;

Â  Â  uploadBtn.addEventListener("click", () => uploadInput.click());

Â  Â  uploadInput.addEventListener("change", (e) => {
Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  if (!file) return;

Â  Â  Â  const reader = new FileReader();
Â  Â  Â  reader.onload = function (event) {
Â  Â  Â  Â  userImage = new Image();
Â  Â  Â  Â  userImage.onload = function () {
Â  Â  Â  Â  Â  scale = 1;
Â  Â  Â  Â  Â  posX = 0;
Â  Â  Â  Â  Â  posY = 0;
Â  Â  Â  Â  Â  drawCanvas();

Â  Â  Â  Â  Â  uploadBtn.style.display = "none";
Â  Â  Â  Â  Â  unduhBtn.style.display = "inline-block";
Â  Â  Â  Â  Â  uploadTwibbonBtn.style.display = "inline-block";
Â  Â  Â  Â  };
Â  Â  Â  Â  userImage.src = event.target.result;
Â  Â  Â  };
Â  Â  Â  reader.readAsDataURL(file);
Â  Â  });

Â  Â  uploadTwibbonBtn.addEventListener("click", () => {
Â  Â  Â  twibbonInput.click();
Â  Â  });

Â  Â  twibbonInput.addEventListener("change", (e) => {
Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  if (!file) return;

Â  Â  Â  if (!file.type.includes("png")) {
Â  Â  Â  Â  alert("Twibbon harus berupa file PNG.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const reader = new FileReader();
Â  Â  Â  reader.onload = function (event) {
Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  img.onload = function () {
Â  Â  Â  Â  Â  const tempCanvas = document.createElement("canvas");
Â  Â  Â  Â  Â  const tempCtx = tempCanvas.getContext("2d");
Â  Â  Â  Â  Â  tempCanvas.width = img.width;
Â  Â  Â  Â  Â  tempCanvas.height = img.height;
Â  Â  Â  Â  Â  tempCtx.drawImage(img, 0, 0);
Â  Â  Â  Â  Â  const imageData = tempCtx.getImageData(0, 0, img.width, img.height).data;

Â  Â  Â  Â  Â  let hasTransparency = false;
Â  Â  Â  Â  Â  for (let i = 3; i < imageData.length; i += 4) {
Â  Â  Â  Â  Â  Â  if (imageData[i] < 255) {
Â  Â  Â  Â  Â  Â  Â  hasTransparency = true;
Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  if (!hasTransparency) {
Â  Â  Â  Â  Â  Â  alert("Twibbon harus memiliki bagian transparan (PNG transparan).");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  twibbonImage = img;
Â  Â  Â  Â  Â  drawCanvas();
Â  Â  Â  Â  };
Â  Â  Â  Â  img.src = event.target.result;
Â  Â  Â  };
Â  Â  Â  reader.readAsDataURL(file);
Â  Â  });

Â  Â  unduhBtn.addEventListener("click", () => {
Â  Â  Â  // ðŸ”§ Mulai proses blur dan spinner
Â  Â  Â  canvas.style.filter = "blur(3px)";
Â  Â  Â  processingOverlay.style.display = "flex";
Â  Â  Â  downloadAlt.style.display = "none";

Â  Â  Â  unduhBtn.disabled = true;

Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  canvas.toBlob((blob) => {
Â  Â  Â  Â  Â  const url = URL.createObjectURL(blob);
Â  Â  Â  Â  Â  const link = document.createElement("a");
Â  Â  Â  Â  Â  link.download = "twibbon.png";
Â  Â  Â  Â  Â  link.href = url;
Â  Â  Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  Â  Â  link.click();

Â  Â  Â  Â  Â  // ðŸ”§ Tampilkan link alternatif jika gagal
Â  Â  Â  Â  Â  downloadAlt.style.display = "block";
Â  Â  Â  Â  Â  downloadAlt.onclick = () => window.open(url, '_blank');

Â  Â  Â  Â  Â  // Reset tampilan
Â  Â  Â  Â  Â  canvas.style.filter = "none";
Â  Â  Â  Â  Â  processingOverlay.style.display = "none";
Â  Â  Â  Â  Â  unduhBtn.style.display = "none";
Â  Â  Â  Â  Â  bagikanBtn.style.display = "inline-block";
Â  Â  Â  Â  }, "image/png");
Â  Â  Â  }, 15000); // ðŸ”§ 15 detik delay
Â  Â  });

Â  Â  bagikanBtn.addEventListener("click", () => {
Â  Â  Â  canvas.toBlob(async (blob) => {
Â  Â  Â  Â  const file = new File([blob], "twibbon.png", { type: "image/png" });
Â  Â  Â  Â  if (navigator.canShare && navigator.canShare({ files: [file] })) {
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  await navigator.share({
Â  Â  Â  Â  Â  Â  Â  title: "Twibbon Saya",
Â  Â  Â  Â  Â  Â  Â  text: "Lihat hasil twibbon saya!",
Â  Â  Â  Â  Â  Â  Â  files: [file],
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  alert("Gagal membagikan: " + err.message);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert("Perangkat ini tidak mendukung Web Share API dengan file.");
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  });

Â  Â  canvas.addEventListener("touchstart", (e) => {
Â  Â  Â  isTouching = true;
Â  Â  Â  if (e.touches.length === 1) {
Â  Â  Â  Â  isDragging = true;
Â  Â  Â  Â  lastPosX = e.touches[0].clientX - posX;
Â  Â  Â  Â  lastPosY = e.touches[0].clientY - posY;
Â  Â  Â  } else if (e.touches.length === 2) {
Â  Â  Â  Â  lastTouches = e.touches;
Â  Â  Â  Â  lastScale = scale;
Â  Â  Â  }
Â  Â  });

Â  Â  canvas.addEventListener("touchmove", (e) => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  if (e.touches.length === 1 && isDragging) {
Â  Â  Â  Â  posX = e.touches[0].clientX - lastPosX;
Â  Â  Â  Â  posY = e.touches[0].clientY - lastPosY;
Â  Â  Â  } else if (e.touches.length === 2 && lastTouches.length === 2) {
Â  Â  Â  Â  const [t1, t2] = e.touches;
Â  Â  Â  Â  const dx = t2.clientX - t1.clientX;
Â  Â  Â  Â  const dy = t2.clientY - t1.clientY;
Â  Â  Â  Â  const dist = Math.hypot(dx, dy);

Â  Â  Â  Â  const [lt1, lt2] = lastTouches;
Â  Â  Â  Â  const ldx = lt2.clientX - lt1.clientX;
Â  Â  Â  Â  const ldy = lt2.clientY - lt1.clientY;
Â  Â  Â  Â  const lastDist = Math.hypot(ldx, ldy);

Â  Â  Â  Â  const zoom = dist / lastDist;
Â  Â  Â  Â  scale = Math.min(5, Math.max(0.5, lastScale * zoom));
Â  Â  Â  }
Â  Â  Â  drawCanvas();
Â  Â  }, { passive: false });

Â  Â  canvas.addEventListener("touchend", () => {
Â  Â  Â  isDragging = false;
Â  Â  Â  isTouching = false;
Â  Â  Â  lastTouches = [];
Â  Â  Â  lastScale = scale;
Â  Â  Â  drawCanvas();
Â  Â  });
Â  </script>
</body>
</html>
